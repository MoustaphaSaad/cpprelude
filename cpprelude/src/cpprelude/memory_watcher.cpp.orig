#include "cpprelude/memory_watcher.h"

namespace cpprelude
{
	//memory watcher
<<<<<<< HEAD
	memory_watcher_t::memory_watcher_t(const char* scope_name)
=======
	memory_watcher::memory_watcher(const char* scope_name)
>>>>>>> master
		:name(scope_name)
	{
		if(name == nullptr) name = "unnamed";
		begin_watching();
	}

<<<<<<< HEAD
	memory_watcher_t::~memory_watcher_t()
=======
	memory_watcher::~memory_watcher()
>>>>>>> master
	{
		end_watching();
#ifdef DEBUG
		print_report();
#endif
	}

	void
<<<<<<< HEAD
	memory_watcher_t::begin_watching()
=======
	memory_watcher::begin_watching()
>>>>>>> master
	{
		_a_alive_allocations = platform.allocation_count;
		_a_allocation_size = platform.allocation_size;
	}

	void
<<<<<<< HEAD
	memory_watcher_t::end_watching()
=======
	memory_watcher::end_watching()
>>>>>>> master
	{
		_b_alive_allocations = platform.allocation_count;
		_b_allocation_size = platform.allocation_size;
	}

	usize
<<<<<<< HEAD
	memory_watcher_t::delta_alive_allocations() const
=======
	memory_watcher::delta_alive_allocations() const
>>>>>>> master
	{
		return _b_alive_allocations - _a_alive_allocations;
	}

	usize
<<<<<<< HEAD
	memory_watcher_t::delta_size() const
=======
	memory_watcher::delta_size() const
>>>>>>> master
	{
		return _b_allocation_size - _a_allocation_size;
	}

	void
<<<<<<< HEAD
	memory_watcher_t::print_report() const
=======
	memory_watcher::print_report() const
>>>>>>> master
	{
		if(delta_alive_allocations() != 0)
		{
			println(std::cout, "memory_watcher ", name,
					"{alive allocations: ", delta_alive_allocations(),
					", size: ", delta_size(), "}");
		}
	}
}